{% extends "layout.html" %}

{% block content %}
  <h1>Apartments</h1>

  <a href="{{ url_for('new_apartment') }}">Add New Apartment</a>

  <table>
    <thead>
      <tr>
        <th>Unit</th>
        <th>Building</th>
        <th>Rent</th>
        <th>Tenants</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for apt in apartments %}
        <tr>
          <td>{{ apt.unit_number }}</td>
          <td>{{ apt.building_name }}</td>
          <td>${{ "%.2f"|format(apt.rent) }}</td>
          <td>
            {% if apt.tenants %}
              <ul>
                {% for tenant in apt.tenants %}
                  <li>
                    {{ tenant.name }}
                    <a href="{{ url_for('edit_tenant', id=tenant.id) }}">Edit</a>
                    <form method="post" action="{{ url_for('delete_tenant', id=tenant.id) }}" style="display:inline;">
                      <button type="submit" onclick="return confirm('Are you sure you want to delete this tenant?');">
                        Delete
                      </button>
                    </form>
                  </li>
                {% endfor %}
              </ul>
            {% else %}
              <em>Vacant</em>
            {% endif %}

            <!-- Always show Add Tenant -->
            <a href="{{ url_for('new_tenant', id=apt.id) }}">Add Tenant</a>
          </td>
          <td>
            <a href="{{ url_for('edit_apartment', id=apt.id) }}">Edit</a>
            <form method="post" action="{{ url_for('delete_apartment', id=apt.id) }}" style="display:inline;">
              <button type="submit" onclick="return confirm('Are you sure you want to delete this apartment?');">
                Delete
              </button>
            </form>
          </td>
        </tr>
      {% endfor %}
    </tbody>
  </table>

  <div class="pagination">
    {% if page > 1 %}
      <a href="{{ url_for('list_apartments', page=page-1) }}">Previous</a>
    {% endif %}

    <span>Page {{ page }} of {{ total_pages }}</span>

    {% if page < total_pages %}
      <a href="{{ url_for('list_apartments', page=page+1) }}">Next</a>
    {% endif %}
  </div>

{% endblock %}
